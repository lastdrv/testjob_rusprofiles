# Тестовое задание по парсингу rusprofiles

### Зависимости

Для работы потребуется Python3 и MySQL
И следующие пакеты:

```sh
pip3 install scrapy
pip3 install scrapy_mysql_pipeline
pip3 install scrapy-proxies-tool
```

Далее создаём таблицу из файла create_tbl_test.sql
Настройки базы данных находятся в settings.py

Запуск программы
```sh
python3 main.py
```


### По прокси, многопоточности и прочему

Сайт rusprofiles.ru очень чувствителен к парсингу.

Малейшее подозрение и прилетает капча. В случае её игнорирования сайт начинает слать левые данные.

По этому к подбору проксей и выбору коэффициентов запросов/задержек нужно подходить очень нежно.

Хорошие прокси должны быть обязательно анонимными.

Поискать их можно здесь https://best-proxies.ru/proxylist/elite/ или в любом другом месте.

Так же можно посмотреть от куда берут прокси проекты

https://github.com/yogendratamang48/ProxyList

https://github.com/sh4dowb/proxy-scraper

Для получения оптимального результата (спарсить всё без капчи) нужно проксей 5-8.

Больше не надо, вероятность найти одновременно более 10-20 рабочих анонимных проксей стремится к нулю, а нерабочие будут сильно тормозить процесс.

Список проксей помещается в файл list_proxies.txt

Но это подобранные мной прокси с которыми получилось после долгих попыток поиска рабочих. На текущий момент они наверняка умерли.

По этому либо заполняем своим списком в формате ip_adress:port

Либо в settings.py комментируем строчку ROTATING_PROXY_LIST_PATH и раскомментируем ROTATING_PROXY_LIST

Список ROTATING_PROXY_LIST = [] можно заполнить своими прокси или оставить пустым для работы без прокси.

Что чревато капчей (!!!) и визуальным баном по ip на несколько часов.

Моногопоточность настраивается в том же файле в строке CONCURRENT_REQUESTS

Задержка между запросами - DOWNLOAD_DELAY

Число больше 2-3 в первой строке увеличивает вероятность капчи


### Варианты решения проблем

1. Собрать ссылки на профили организаций (на это не много запросов надо, по числу пагинаций), потом вытаскивать их до капчи и "приходите завтра"
2. Платные/приватные прокси и аккуратное их переключение
2. Использование сервисов типа https://anti-captcha.com/mainpage или https://rucaptcha.com/for-customer
3. Selenium + ML для самостоятельной борьбы с капчей


### P.S.

1. Я бы внёс изменение в ТЗ - добавить в БД поле с ссылкой на профиль организации, чтобы была потом возможность восстановить информацию когда сервер начнёт слать левые данные
2. Соответственно после работы база нуждается в валидации данных, например по ОГРН (левый легко отличить). Это можно было бы отловить и в процессе работы и прерваться, но названия организаций вроде продолжает выдавать правильные.
3. Тестировать на корректность работы без прокси можно по следующему ОКВЭД - https://www.rusprofile.ru/codes/12200
